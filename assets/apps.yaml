---
repositories:
  - name: kuberay
    url: https://ray-project.github.io/kuberay-helm/
  - name: nvidia
    url: https://helm.ngc.nvidia.com/nvidia
  - name: kalavai
    url: https://kalavai-net.github.io/helm-charts/
  - name: hami-charts
    url: https://project-hami.github.io/HAMi/
  - name: longhorn
    url: https://charts.longhorn.io

releases:
  - name: kuberay
    namespace: kuberay
    chart: kuberay/kuberay-operator
    installed: true
  - name: kuberay-apiserver
    namespace: kuberay
    chart: kuberay/kuberay-apiserver
    installed: false
  - name: longhorn-system
    namespace: kalavai
    chart: longhorn/longhorn
    installed: true
    set:
    # security issue! enable for testing only
    # - name: service.ui.type
    #   value: NodePort
    # - name: service.ui.nodePort
    #   value: $longhorn_ui_port
  - name: lws
    namespace: kalavai
    chart: kalavai/lws
    installed: true
  - name: kalavai-watcher
    namespace: kalavai
    chart: kalavai/kalavai-watcher
    installed: true
    set:
    - name: namespace
      value: kalavai
    - name: deployment.in_cluster
      value: "True"
    - name: deployment.use_auth_key
      value: "True"
    - name: deployment.auth_key
      value: "$watcher_auth_key"
    - name: deployment.readonly_key
      value: "$watcher_readonly_key"
    - name: service.nodePort
      value: $watcher_port
  - name: nvidia-gpu-operator
    namespace: kalavai
    chart: kalavai/gpu
    installed: true
  - name: helios
    namespace: kalavai
    chart: kalavai/kalavai-helios
    installed: $deploy_helios
    set:
    - name: deployment.watcher_endpoint
      value: "http://$watcher_service"
    - name: deployment.watcher_auth_key
      value: "$watcher_readonly_key"
    - name: deployment.kalavai_api_endpoint
      value: "https://platform.kalavai.net/_/api"
    - name: deployment.user_node_label
      value: "$user_node_label"
    - name: deployment.sleep_interval
      value: 600
    
  - name: hami-vgpu
    namespace: kalavai
    chart: hami-charts/hami
    installed: true
    set:
    - name: scheduler.kubeScheduler.imageTag
      value: v1.31.1
    - name: devicePlugin.runtimeClassName
      value: "nvidia"
    - name: devicePlugin.deviceMemoryScaling
      value: "1"
    - name: devicePlugin.deviceSplitCount
      value: "1"
    - name: scheduler.defaultSchedulerPolicy.nodeSchedulerPolicy
      value: "binpack"
    - name: scheduler.defaultSchedulerPolicy.gpuSchedulerPolicy
      value: "binpack"

